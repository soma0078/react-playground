#!/bin/sh

echo "ğŸ” [1] Staged TypeScript/JS/TSX/JSX íŒŒì¼ ê²€ì‚¬ ì‹œì‘"

# 1. ìŠ¤í…Œì´ì§•ëœ íŒŒì¼ë§Œ í•„í„°ë§
TS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' || true)
OTHER_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(css|scss|md|json)$' || true)

# 2. íŒŒì¼ ëª©ë¡ ì¶œë ¥
echo "ğŸ§ª TypeScript/JS files: $TS_FILES"
echo "ğŸ§ª Other files: $OTHER_FILES"

# 3. TypeScript ê²€ì‚¬
if [ -n "$TS_FILES" ]; then
  npx tsc --noEmit --pretty false --skipLibCheck --project tsconfig.app.json
  STATUS=$?
  if [ $STATUS -ne 0 ]; then
    echo "âŒ TypeScript íƒ€ì… ì˜¤ë¥˜ ë°œìƒ. ì»¤ë°‹ ì¤‘ë‹¨!"
    exit 1
  fi
fi

# 4. ESLint ê²€ì‚¬
if [ -n "$TS_FILES" ]; then
  npx eslint --fix $TS_FILES
fi

# 5. Prettier ê²€ì‚¬
if [ -n "$TS_FILES$OTHER_FILES" ]; then
  npx prettier --write $TS_FILES $OTHER_FILES
fi

# 6. ë‹¤ì‹œ staged ìƒíƒœë¡œ ì¶”ê°€
if [ -n "$TS_FILES$OTHER_FILES" ]; then
  git add $TS_FILES $OTHER_FILES
fi

echo "âœ… ëª¨ë“  ê²€ì‚¬ í†µê³¼. ì»¤ë°‹ ì§„í–‰"
exit 0
